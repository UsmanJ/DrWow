extends layout

block content
  script(src='https://cdn.socket.io/socket.io-1.3.7.js')
  script.
    var socket = io();

  if(!params.user)
    .row
        .large-3.columns
          h1
            img(src='img/DrWow.jpg')
        .large-9.columns
            ul.button-group.right
              li
                a.button.small.success(href="/login") Login
              li
                a.button.small.success(href="/register") Register
  if(params.user)
    .row
        .large-3.columns
          h1
            img(src='img/DrWow.jpg')
        .large-9.columns
            ul.button-group.right
              li
                a.button.small.success(href="/logout") Logout
        .large-12.columns
            hr

    .row
      if(params.user.role === "doctor")
        script.
          socket.on('pt', function(msg){
          $('#patient_username').append(msg.user);
          });

          socket.emit('dr', ('#{params.user.username}'));

        .large-12.columns
          h3 Welcome #{params.user.username}
          #layoutContainer
            #publisherContainer
          div(ng-controller='DrCtrl as dr')
            button.small.secondary(ng-click='dr.createSession()', ng-hide='') Create Call
            button.small.secondary(ng-click='dr.forceDisconnect()') Force Disconnect
          if(params.patients_array.length === 0)
            p No patients online
          else
            p Your patient is #{params.patients_array[0].username}
            p#patient_username
            form(role='form', action="/consultation",method="post", style='max-width: 300px;')
              .form-group
                  input.form-control(type='text', name="comments", placeholder='Enter Comments', id='comments')
              .form-group
                input.form-control(type='text', name="prescription", placeholder='Prescription', id='prescription')
              .form-group
                input.form-control(type='date', name="date", id='date')
              .form-group
                  input.form-control(type='hidden', readonly="readonly", name="doctor", value='(#{params.user._id})', id='role')
              .form-group
                  input.form-control(type='hidden', readonly="readonly", name="patient", value='(#{params.patients_array[0]._id})', id='role')
              button.small.secondary(type='submit', id='submit') Submit

      if(params.user.role === "patient")
        script.
          socket.on('dr', function(msg){
          $('#dr_username').append(msg.user);
          });
          socket.emit('pt', ('#{params.user.username}, #{params.user.role}' ));
        h3 Welcome #{params.user.username}
        if(params.doctors_array.length === 0)
          p No doctors online
        else
          p Your doctor is #{params.doctors_array[0].username}
          p#dr_username
          #layoutContainer
            #publisherContainer
          div(ng-controller='DrCtrl as dr')
            button.small.secondary(ng-click='dr.joinSession()') Join Call


  footer.row
    .large-12.columns
      hr
      .row
        .large-6.columns
          p DrWow
